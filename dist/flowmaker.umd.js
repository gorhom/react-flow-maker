!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("js-sha1")):"function"==typeof define&&define.amd?define(["react","js-sha1"],e):t.flowmaker=e(t.react,t.sha1)}(this,function(t,e){t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var o=function(){this.conf={components:{},introComponents:[]},this.errors=[]};o.prototype.title=function(t){return this.conf.components[t].title},o.prototype.get=function(){return this.conf},o.prototype.parseNewLogic=function(t){var e=[],o=function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];e.push(t.join(" ")),console.log.apply(console,["logic parse warning:"].concat(t))},n={components:{},introComponents:[]};return t.components&&(Array.isArray(t.components)?(t.components.map(function(t,e){if(t.name&&t.title){var i=[],s={name:t.name,title:t.title,next:t.next?Array.isArray(t.next)?t.next:[t.next]:[],tooltip:t.tooltip,inputs:[],advancedInputs:[]};Array.isArray(t.inputs)&&t.inputs.map(function(t,n){if(t.title&&t.name&&t.type)if("function"==typeof t.validation||void 0===t.validation)if("string"==typeof t.tooltip||void 0===t.tooltip)if(-1==i.indexOf(t.name)){var a={name:t.name,title:t.title,type:t.type,validation:t.validation,tooltip:t.tooltip,default:t.default};switch(t.type){case"text":"string"!=typeof t.default&&void 0!==t.default&&(o("logic.components["+e+"].inputs["+n+"].default must be a string or undefined, using default empty string"),a.default=""),null==t.default&&(a.default="");break;case"number":"number"!=typeof t.default&&void 0!==t.default&&(o("logic.components["+e+"].inputs["+n+"].default must be a number or undefined, using default 0"),a.default=0),null==t.default&&(a.default=0);break;case"switch":"boolean"!=typeof t.default&&void 0!==t.default&&(o("logic.components["+e+"].inputs["+n+"].default must be a boolean or undefined, using default empty string"),a.default=!1),null==t.default&&(a.default=!1);break;case"dropdown":if(!Array.isArray(t.options))return void o("logic.components["+e+"].inputs["+n+"].options is not defined or is not an array, skipping this item");a.options=t.options.map(function(t,i){if("string"==typeof t.title&&"string"==typeof t.value&&("string"==typeof t.tooltip||null==t.tooltip))return{title:t.title,tooltip:t.tooltip,value:t.value};o("logic.components["+e+"].inputs["+n+"].options["+i+"] does not have the correct items (title string, value string, tooltip string), skipping this item")}).filter(function(t){return t});break;default:return void o("logic.components["+e+"].inputs["+n+"].type = '"+t.type+"' is not valid, this input will be ignored")}i.push(t.name),s[t.advanced?"advancedInputs":"inputs"].push(a)}else o("logic.components["+e+"].inputs["+n+"].name can't be equal to other names");else o("logic.components["+e+"].inputs["+n+"].tooltip must be a string or not undefined");else o("logic.components["+e+"].inputs["+n+"].validation must be undefined or a function");else o("logic.components["+e+"].inputs["+n+"] does not have a name, type or title field, this input will be ignored")}),n.components[t.name]=s}else o("logic.components["+e+"] does not have a name or title field, this component will be ignored")}),Object.keys(n.components).map(function(t){n.components[t].next=n.components[t].next.filter(function(t){return!!n.components[t]||(o("logic.component[???].next contains '"+t+"' that does not exsist, this item will be ignored"),!1)})})):o("logic.components is not an array")),t.introComponents&&(Array.isArray(t.introComponents)?t.introComponents.map(function(t){n.components[t]?n.introComponents.push(t):o("logic.introComponents['"+t+"'] is not a known component")}):"string"==typeof t.introComponents?n.components[t.introComponents]?n.introComponents.push(t.introComponents):o("logic.introComponents = '"+name+"' is not a known component"):o("logic.introComponents is not an array or string")),this.errors=e,this.conf=n,n};var n=function(t,e){this.Logic=t,this.FlowMaker=e,this.maxDepth=0,this.flow=[],this.exportBuzzy=!1,this.reExport=!1,this.exportFunc=void 0};n.prototype.setExportFunc=function(t){this.exportFunc=t},n.prototype.caclMaxDepth=function(){var t=this;this.maxDepth=0;var e=function(o){o.map(function(o){o.depth>t.maxDepth&&(t.maxDepth=o.depth),e(o.next)})};e(this.flow)},n.prototype.flowItem=function(t,e,o){var n=function(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<20;n++)e+=o.charAt(Math.floor(Math.random()*o.length));return e}();return{depth:o+1,next:[],id:n,path:e.concat([n]),inputData:{},inputValidation:{},component:t}},n.prototype.startFlow=function(t){var e=this.Logic.conf.components[t];e&&(this.flow.push(this.flowItem(e,[],0)),this.caclMaxDepth(),this.FlowMaker.forceUpdate(),this.export())},n.prototype.addComponent=function(t,e){var o=this.Logic.conf.components[t];if(o){var n=this.findPath(e);n.next.push(this.flowItem(o,n.path,n.depth)),this.caclMaxDepth(),this.FlowMaker.forceUpdate(),this.export()}},n.prototype.findPath=function(t){var e=void 0,o=function(n){for(var i=0;i<n.length;i++){if(n[i].path===t){e=n[i];break}o(n[i].next)}};return o(this.flow),e},n.prototype.removeComponent=function(t){var e=function(o){for(var n=0;n<o.length;n++){if(o[n].path===t){o.splice(n,1);break}e(o[n].next)}};e(this.flow),this.caclMaxDepth(),this.FlowMaker.forceUpdate(),this.export()},n.prototype.export=function(){var t=this;this.exportBuzzy?this.reExport=!0:(this.exportBuzzy=!0,setTimeout(function(){if(t.reExport)return t.exportBuzzy=!1,t.reExport=!1,void t.export();var e=[],o=function(t,e){e.map(function(e){t.push({component:{title:e.component.title,name:e.component.name},inputs:Object.keys(e.inputData).reduce(function(t,o){return t[o]=e.inputData[o].value,t},{}),id:e.id,next:[]}),o(t[t.length-1].next,e.next)})};o(e,t.flow),"function"==typeof t.exportFunc&&t.exportFunc(e),setTimeout(function(){t.exportBuzzy=!1,t.reExport&&(t.reExport=!1,t.export())},30)},50))},n.prototype.import=function(t){var e=this;if(Array.isArray(t)){var o=[],n=function(t,o,i){t.map(function(t){var s=e.flowItem(e.Logic.conf.components[t.component.name],i,i.length);s.id=t.id,s.inputData=Object.keys(t.inputs).reduce(function(e,o){return e[o]={value:t.inputs[o],error:""},e},{}),s.path.splice(-1,1),s.path.push(t.id),o.push(s),n(t.next,o[o.length-1].next,i.concat([t.id]))})};n(t,o,[]),this.flow=o,this.caclMaxDepth(),this.FlowMaker.forceUpdate()}},n.prototype.updateInputValue=function(t,e,o,n){var i=this.findPath(t);i&&(n?i.component.advancedInputs&&i.component.advancedInputs[o]&&(i.inputData[i.component.advancedInputs[o].name]=e):i.component.inputs&&i.component.inputs[o]&&(i.inputData[i.component.inputs[o].name]=e)),this.export()};var i=function(){return h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},h("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),h("path",{d:"M0 0h24v24H0z",fill:"none"}))},s=function(){return h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},h("path",{fill:"none",d:"M0 0h24v24H0V0z"}),h("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"}))},a=function(){return h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},h("path",{fill:"none",d:"M0 0h24v24H0V0z"}),h("path",{d:"M8.71 11.71l2.59 2.59c.39.39 1.02.39 1.41 0l2.59-2.59c.63-.63.18-1.71-.71-1.71H9.41c-.89 0-1.33 1.08-.7 1.71z"}))},p=function(){return h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},h("path",{fill:"none",d:"M0 0h24v24H0V0z"}),h("path",{d:"M8.71 12.29L11.3 9.7c.39-.39 1.02-.39 1.41 0l2.59 2.59c.63.63.18 1.71-.71 1.71H9.41c-.89 0-1.33-1.08-.7-1.71z"}))},r=function(){return h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},h("path",{fill:"none",d:"M0 0h24v24H0V0z"}),h("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm1-8h-2V7h2v2z"}))},c=function(){return h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},h("path",{d:"M0 0h24v24H0z",fill:"none"}),h("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}))},l=function(t){function e(){t.call(this),this.state={open:!1}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clickRoundButton=function(){this.setState({open:!this.state.open})},e.prototype.clickOption=function(t){this.props.out(t),this.setState({open:!1})},e.prototype.render=function(){var t=this,e=this.props,o=this.state;return h("div",{className:"addIcon"},h("div",{className:"round "+(o.open?"open":"closed"),onClick:function(){return t.clickRoundButton()}},h(i,null)),h("div",{className:"options "+(o.open?"open":"closed")},e.options?e.options.map(function(e,o){return h("div",{onClick:function(){return t.clickOption(e)},key:o,className:"option"},t.props?t.props.Logic.title(e):e)}):""))},e}(t.Component),u=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(){return this.props.tip?h("div",{className:"tooltip transparrent"+(this.props.transparrent?"True":"False")},h("div",{className:"icon"},h(r,null)),h("div",{className:"noWidth"},h("div",{className:"fullwidth"},h("div",{className:"popup"},this.props.tip)))):""},e}(t.Component),d=function(t){function e(){t.call(this),this.state={value:"",error:"",dropDownSelected:-1,isAfterInit:!1,dropDownopen:!1}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.tellParent=function(){this.props.onChange&&this.props.onChange({error:this.state.error,value:this.state.value})},e.prototype.updateDefaultVal=function(){var t=this;if(this.props.input&&!this.state.isAfterInit){var e=void 0!==this.props.initalVal?this.props.initalVal:this.props.input.default;this.setState({value:e,isAfterInit:!0},function(){t.validate(e,function(){if("dropdown"==t.props.input.type&&-1==t.state.dropDownSelected){var o=0;t.props.input.options.map(function(t,n){t.value==e&&(o=n)}),t.setState({dropDownSelected:o})}t.tellParent()})})}},e.prototype.validate=function(t,e){if("function"==typeof this.props.input.validation){var o=this.props.input.validation(void 0,t);"string"!=typeof o&&(o=""),this.setState({error:o},e)}"function"==typeof e&&e()},e.prototype.updateValue=function(t){var e=this;this.setState({value:t},function(){e.validate(t,function(){e.tellParent()})})},e.prototype.componentDidMount=function(){this.updateDefaultVal()},e.prototype.componentDidUpdate=function(){this.updateDefaultVal(),this.props.hiddenDropdown&&this.state.dropDownopen&&this.setState({dropDownopen:!1})},e.prototype.render=function(){var t=this,e=this.state.error,o=this.props.input;return o?h("div",{className:"input hasErr"+(e?"True":"False")},h("div",{className:"label"},h("span",null,o.title),h(u,{transparrent:!0,tip:o.tooltip})),h("div",{className:"actualInput"},"text"==o.type||"number"==o.type?h("div",{className:"text"},h("input",{type:o.type,value:this.state.value,onChange:function(e){return t.updateValue(e.target.value)}})):"switch"==o.type?h("div",{className:"switch"},h("div",{onClick:function(){return t.updateValue(!t.state.value)},className:"actualSwitch "+(this.state.value?"true":"false")},h("div",{className:"inside"},h(c,null)))):"dropdown"==o.type?h("div",{className:"dropdown"},h("div",{className:"select",onClick:function(){return t.setState({dropDownopen:!t.state.dropDownopen})}},h("div",{className:"optTitle"},-1==this.state.dropDownSelected?"...":o.options[this.state.dropDownSelected].title),h("div",{className:"icon"},h(a,null))),h("div",{className:"options open"+(this.state.dropDownopen?"True":"False")},o.options.map(function(e,o){return h("div",{key:o,className:"option",onClick:function(){console.log("dropdown: start:",e.value),t.updateValue(e.value),t.setState({dropDownSelected:o,dropDownopen:!1})}},h("div",{className:"optTitle"},e.title),h(u,{tip:e.tooltip}))}))):""),e?h("div",{className:"error"},e):""):h("div",{className:"input"})},e}(t.Component),f=function(t){function e(){t.call(this),this.state={hover:!1,showAddOptions:!1,showAdvanced:!1},this.remove=this.remove.bind(this)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.remove=function(){this.props.Tree.removeComponent(this.props.data.path)},e.prototype.add=function(){1!=this.props.data.component.next.length?this.setState({showAddOptions:!0}):this.realAdd(this.props.data.component.next[0])},e.prototype.realAdd=function(t){this.setState({showAddOptions:!1}),t&&this.props.Tree.addComponent(t,this.props.data.path)},e.prototype.render=function(){var t=this,e=this.props.data;if(!e)return"";var o=e.component,n=o.inputs,r=o.advancedInputs;return h("div",{className:"fullBlock hover"+(this.state.hover&&!this.state.showAddOptions?"True":"False"),onMouseOver:function(){return t.setState({hover:!0})},onMouseOut:function(){return t.setState({hover:!1})}},h("div",{className:"side"},h("div",{className:"innerSide"},h("div",{className:"round",onClick:this.remove},h(s,null)))),h("div",{className:"middle"},h("div",{className:"title"},o.title,h(u,{transparrent:!0,tip:o.tooltip})),h("div",{className:"inputs"},n.map(function(o,n){var i=e.inputData[o.name];return h(d,{key:n,input:o,initalVal:i?i.value:void 0,onChange:function(o){t.props.Tree.updateInputValue(e.path,o,n,!1)}})}),r.length>0?h("div",{className:"showAdvanced"},h("div",{className:"button",onClick:function(){t.setState({showAdvanced:!t.state.showAdvanced},function(){t.props.graphParrentInstance?t.props.graphParrentInstance.forceUpdate():t.props.graphInstance&&t.props.graphInstance.forceUpdate()})}},"Advanced ",this.state.showAdvanced?h(p,null):h(a,null))):""),h("div",{className:"inputs advancedInputs show"+(this.state.showAdvanced?"True":"False")},r.map(function(o,n){var i=e.inputData[o.name];return h(d,{hiddenDropdown:!t.state.showAdvanced,key:n,input:o,initalVal:i?i.value:void 0,onChange:function(o){t.props.Tree.updateInputValue(e.path,o,n,!0)}})}))),o.next.length>0?h("div",{className:"nextOptions show"+(this.state.showAddOptions?"True":"False")},h("div",{className:"closePopup",onClick:function(){return t.realAdd()}},h(i,null)),h("div",{className:"pos"},h("div",{className:"optionsTitle"},"Options"),o.next.map(function(e,o){return h("div",{onClick:function(){return t.realAdd({componentName:e})},className:"option",key:o},t.props?t.props.Logic.title(e):e)}))):"",o.next.length>0?h("div",{className:"side"},h("div",{className:"innerSide"},h("div",{className:"round",onClick:function(){return t.add()}},h(i,null)))):"")},e}(t.Component),m=function(t){function e(){t.call(this),this.state={element:void 0,lastParentPosition:0},this.mounted=!1}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.componentDidMount=function(){this.mounted=!0,this.watchParent()},e.prototype.componentWillUnmount=function(){this.mounted=!1},e.prototype.watchParent=function(){var t=this;if(this.mounted){var e=this.props.connectTo,o=void 0;e&&(o=e.getBoundingClientRect()).top!=this.state.lastParentPosition&&this.setState({lastParentPosition:o.top}),setTimeout(function(){t.watchParent()},800)}},e.prototype.render=function(){var t=this,e=0,o=0,n="";if(this.props.connectTo&&this.state.element){var i=this.props.connectTo.getBoundingClientRect(),s=this.state.element.getBoundingClientRect(),a=i.y+i.height/2-(s.y+s.height/2);0==a?(e=20,o=10,n="straight"):a<0?(o=(e=20-a)-10,n="bottomToTop"):(e=a+20,o=10,n="topToBottom")}return h("div",{className:"graphPart",style:{width:this.props.width}},e&&o&&n?h("div",{className:"lineToParrent",style:{bottom:o+"px"}},h("svg",{viewBox:"0 0 80 "+e,height:e+"px",style:{minHeight:e+"px"},xmlns:"http://www.w3.org/2000/svg"},"bottomToTop"==n?h("path",{strokeWidth:"7",stroke:"#ccc",strokeLinecap:"round",fill:"none",d:"M0,10 C70,10 30,"+(e-10)+" 80,"+(e-10)}):"topToBottom"==n?h("path",{strokeWidth:"7",stroke:"#ccc",strokeLinecap:"round",fill:"none",d:"M0,"+(e-10)+" C70,"+(e-10)+" 30,10 80,10"}):h("path",{strokeWidth:"7",stroke:"#ccc",strokeLinecap:"round",fill:"none",d:"M0,10 C70,10 30,10 80,10"}))):"",h("div",{ref:function(e){var o=t.props.connectTo,n=void 0;if(o&&(n=o.getBoundingClientRect()),"object"!=typeof t.state.element||n&&n.top!=t.state.lastParentPosition){var i={element:e};n&&(i.lastParentPosition=n.top),t.setState(i)}},className:"graph",style:{minWidth:this.props.itemWidth}},h(f,{graphInstance:this,graphParrentInstance:this.props.connectToInstance,Tree:this.props.Tree,Logic:this.props.Logic,data:this.props.data})),h("div",{className:"next"},this.props.data.next.map(function(e,o){return h(m,{Tree:t.props.Tree,Logic:t.props.Logic,connectTo:t.state.element,connectToInstance:t,width:t.props.width-t.props.itemWidth,itemWidth:t.props.itemWidth,key:o,data:e})})))},e}(t.Component);return function(t){function i(){t.call(this),this.Logic=new o,this.Tree=new n(this.Logic,this),this.lastlogicHash="",this.state={settings:this.Logic.get()}}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.componentDidMount=function(){var t=this,o=e(this.props.logic);o!=this.lastlogicHash?(this.lastlogicHash=o,this.setState({settings:this.Logic.parseNewLogic(this.props.logic)},function(){return t.afterMount()})):this.afterMount()},i.prototype.afterMount=function(){"function"==typeof this.props.onChange&&this.Tree.setExportFunc(this.props.onChange),"object"==typeof this.props.flow&&this.Tree.import(this.props.flow)},i.prototype.render=function(){var t=this,e=this.state.settings;return h("div",{className:"flowMakerComp"},h("div",{className:"flowMakerContainer",style:{minWidth:250+380*this.Tree.maxDepth+"px"}},h("div",{className:"row",style:{minWidth:"250px"}},e.introComponents.length>0?h("div",{className:"startPoint"},h("h3",null,"Start here"),h(l,{Tree:this.Tree,Logic:this.Logic,options:e.introComponents,out:function(e){return t.Tree.startFlow(e)}})):""),h("div",{className:"actualGraph",style:{width:380*this.Tree.maxDepth+"px"}},this.Tree.flow.map(function(e,o){return h(m,{Tree:t.Tree,Logic:t.Logic,width:380*t.Tree.maxDepth,itemWidth:380,key:o,data:e})}))))},i}(t.Component)});
//# sourceMappingURL=flowmaker.umd.js.map
